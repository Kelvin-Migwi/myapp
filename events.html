<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JKUMSA Events</title>
  <meta name="description" content="JKUAT Muslim Students Association - Events" />
  <style>
    /* ---------- Base ---------- */
    :root{
      --green-1:#036c3c;
      --green-2:#03b050;
      --accent:#04aa6d;
      --bg:#f7fdf9;
      --card:#ffffff;
      --muted:#6b6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg); color:#222; -webkit-font-smoothing:antialiased;
      line-height:1.5;
    }

    /* ---------- Header / Nav ---------- */
    .header{
      background:linear-gradient(90deg,var(--green-1),var(--green-2));
      color:#fff; padding:28px 14px; text-align:center;
      box-shadow:0 4px 10px rgba(2,50,20,0.12);
    }
    .header h1{font-size:28px; margin:0 0 6px}
    .header p{margin:0; opacity:.95}

    .topnav{
      display:flex; gap:6px; justify-content:center; flex-wrap:wrap;
      background:#111; padding:6px;
    }
    .topnav a{
      color:#fff; padding:10px 16px; text-decoration:none; font-weight:600;
      border-radius:6px; transition:all .18s;
    }
    .topnav a:hover{background:var(--accent)}
    .topnav a.active{background:var(--accent)}

    /* ---------- Page container ---------- */
    .container{max-width:1180px; margin:26px auto; padding:0 16px}

    /* ---------- Search / Filter ---------- */
    .toolbar{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:14px}
    .search {
      display:flex; gap:8px; align-items:center;
      background:var(--card); padding:8px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.06)
    }
    .search input{
      border:0; outline:none; padding:8px; min-width:220px; font-size:14px; background:transparent;
    }
    .hint{color:var(--muted); font-size:13px}

    /* ---------- Events table ---------- */
    .events-section {background:var(--card); border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h2.section-title{color:var(--green-1); text-align:center; margin:6px 0 14px}

    table {
      width:100%; border-collapse:collapse; min-width:900px;
      border-radius:8px; overflow:hidden;
    }
    thead th{
      background:var(--accent); color:#fff; padding:12px 10px; text-align:center; font-weight:700;
      position:sticky; top:0;
    }
    tbody td, tbody th{padding:12px; border-bottom:1px solid #eee; text-align:center; vertical-align:middle}
    tbody tr:nth-child(even){background:#fbfbfb}
    td.cell {cursor:pointer; transition:background .18s}
    td.cell:hover{background:#e6f7ef}

    /* ---------- Carousel ---------- */
    .carousel {
      max-width:1000px; margin:30px auto 10px; position:relative; border-radius:14px; overflow:hidden;
      box-shadow:0 8px 28px rgba(2,30,10,0.12); background:var(--card);
    }
    .slides {display:flex; transition:transform .7s cubic-bezier(.25,.8,.25,1)}
    .slide {flex:0 0 100%; position:relative; height:420px; display:flex; align-items:center; justify-content:center; background:#000}
    .slide img, .slide video{width:100%; height:420px; object-fit:cover; display:block}
    .slide .label {
      position:absolute; left:18px; bottom:18px; background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.25));
      color:#fff; padding:10px 14px; border-radius:8px; font-weight:700; backdrop-filter: blur(4px);
    }
    .carousel .control {
      position:absolute; top:50%; transform:translateY(-50%); z-index:40;
      width:44px; height:44px; border-radius:50%; border:0; background:rgba(0,0,0,0.45); color:#fff; cursor:pointer;
      display:flex; align-items:center; justify-content:center; font-size:20px;
    }
    .carousel .prev{left:14px}
    .carousel .next{right:14px}
    .carousel .dots {position:absolute; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:8px}
    .dot {width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.45); cursor:pointer; border:2px solid rgba(255,255,255,0.15)}
    .dot.active{background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.25)}

    /* ---------- Media cards (fallback & gallery) ---------- */
    .media-grid {display:grid; gap:18px; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); margin-top:18px}
    .media-card {background:var(--card); border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .media-card img, .media-card video{width:100%; height:200px; object-fit:cover; display:block}
    .media-card p{padding:10px; color:var(--green-1); font-weight:600; text-align:center}

    /* ---------- Modal ---------- */
    .modal {position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background:rgba(0,0,0,0.6)}
    .modal.show{display:flex}
    .modal-dialog {
      width:94%; max-width:520px; background:#fff; border-radius:12px; padding:18px; position:relative;
      box-shadow:0 10px 40px rgba(2,30,10,0.2); transform-origin:center; animation:pop-in .32s ease;
    }
    @keyframes pop-in { from{opacity:0; transform:scale(.96);} to{opacity:1; transform:scale(1);} }
    @keyframes pop-out { from{opacity:1; transform:scale(1);} to{opacity:0; transform:scale(.96);} }
    .modal-close {position:absolute; right:12px; top:10px; font-size:20px; color:#666; cursor:pointer}
    .modal h3{color:var(--green-1); margin:6px 0 8px}
    .modal p{color:#444; margin:6px 0 12px}
    .modal .actions{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .btn {
      display:inline-block; text-decoration:none; padding:10px 14px; border-radius:8px; font-weight:700;
      color:#fff; cursor:pointer;
    }
    .btn.form{background:var(--accent)}
    .btn.cal{background:var(--green-1)}
    .btn.media{background:#0a7b6a}
    .btn:hover{opacity:.94}

    /* modal media */
    .modal-media {margin-top:12px; border-radius:8px; overflow:hidden}
    .modal-media img, .modal-media video{width:100%; max-height:320px; object-fit:cover; display:block}

    /* responsive tweaks */
    @media (max-width:800px){
      .slide, .slide img, .slide video {height:260px}
      .carousel {margin:18px}
      .modal-dialog {padding:14px}
      table {min-width:720px}
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>JKUMSA</h1>
    <p>JKUAT Muslim Students Association — Events & Media</p>
  </header>

  <nav class="topnav" aria-label="Main navigation">
    <a href="home.html">Home</a>
    <a href="mosque.html">Mosque & Prayer Times</a>
    <a href="charity.html">Donate</a>
    <a href="learning.html">Learning</a>
    <a href="business.html">Shop</a>
    <a class="active">Events</a>
    <a href="login.html">Login</a>
  </nav>

  <main class="container">
    <!-- Toolbar: search/filter -->
    <div class="toolbar">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" placeholder="Search events (e.g., Hafla, Ramadan, 4th)"/>
      </div>
      <div class="hint">Click an event date to view details, register or add to calendar.</div>
    </div>

    <!-- Carousel (highlights) -->
    <section class="carousel" id="carousel" aria-label="Event highlights carousel">
      <div class="slides" id="slides">
        <!-- Slide 0 (image) -->
        <div class="slide">
          <img src="https://images.unsplash.com/photo-1556761175-4b46a572b786?auto=format&fit=crop&w=1400&q=80" alt="First Years Hafla">
          <div class="label">First Years Hafla — Highlights</div>
        </div>
        <!-- Slide 1 (video) -->
        <div class="slide">
          <video muted playsinline loop preload="auto" id="slideVid1">
            <source src="https://cdn.pixabay.com/vimeo/460716513/conference-59946.mp4" type="video/mp4">
          </video>
          <div class="label">Da'wah Conference — Sessions</div>
        </div>
        <!-- Slide 2 (image) -->
        <div class="slide">
          <img src="https://images.unsplash.com/photo-1573495627361-9232a5a0b5a4?auto=format&fit=crop&w=1400&q=80" alt="Orphanage Visit">
          <div class="label">Orphanage Visit — Community</div>
        </div>
        <!-- Slide 3 (video) -->
        <div class="slide">
          <video muted playsinline loop preload="auto" id="slideVid2">
            <source src="https://cdn.pixabay.com/vimeo/253693021/teamwork-19360.mp4" type="video/mp4">
          </video>
          <div class="label">Grand Iftar — Preparations</div>
        </div>
      </div>

      <button class="control prev" id="prevBtn" aria-label="Previous slide">❮</button>
      <button class="control next" id="nextBtn" aria-label="Next slide">❯</button>
      <div class="dots" id="dots"></div>
    </section>

    <!-- Events Table -->
    <section class="events-section" aria-labelledby="eventsHeading">
      <h2 id="eventsHeading" class="section-title">JKUMSA Event Calendar</h2>

      <div style="overflow:auto">
        <table id="eventsTable" role="table">
          <thead>
            <tr>
              <th>Month</th>
              <th>First Years Registration</th>
              <th>First Years Hafla</th>
              <th>Cooking</th>
              <th>Annual Da'wah Conference</th>
              <th>Ramadan (Start / End)</th>
              <th>Grand Iftar</th>
              <th>Hospital Cleaning</th>
              <th>Orphanage Visit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>September</th>
              <td class="cell" data-event="reg">1st – 3rd</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
            </tr>

            <tr>
              <th>October</th>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="hafla">4th</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
            </tr>

            <tr>
              <th>November</th>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="cooking">10th</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="iftar">20th</td>
              <td class="cell" data-event="">-</td>
              <td class="cell" data-event="">-</td>
            </tr>

            <tr>
              <th>December</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="conference">23rd</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="orphanage">30th</td>
            </tr>

            <tr>
              <th>January</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="conference">23rd</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
            </tr>

            <tr>
              <th>February</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="ramadan">Start: 20th</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="">-</td>
            </tr>

            <tr>
              <th>March</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="ramadanEnd">End: 22nd</td>
              <td class="cell" data-event="iftar">18th</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
            </tr>

            <tr>
              <th>April</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="orphanage">10th</td>
            </tr>

            <tr>
              <th>May</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">5th</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">12th</td>
              <td class="cell">22nd</td>
              <td class="cell">-</td>
            </tr>

            <tr>
              <th>June</th>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell">15th</td>
              <td class="cell">-</td>
              <td class="cell">-</td>
              <td class="cell" data-event="cleaning">25th</td>
              <td class="cell">-</td>
            </tr>

          </tbody>
        </table>
      </div>
    </section>

    <!-- Media grid (fallback for small screens) -->
    <section>
      <div class="media-grid" id="mediaGrid">
        <div class="media-card">
          <img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&w=1200&q=80" loading="lazy" alt="Hafla photo">
          <p>First Years Hafla</p>
        </div>
        <div class="media-card">
          <video controls preload="metadata" poster="https://images.unsplash.com/photo-1541542684-5d9e6f6f9b22?auto=format&fit=crop&w=1200&q=80">
            <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
          </video>
          <p>Cooking Session</p>
        </div>
        <div class="media-card">
          <img src="https://images.unsplash.com/photo-1581090700227-1e37b190418e?auto=format&fit=crop&w=1200&q=80" loading="lazy" alt="conference">
          <p>Annual Da’wah Conference</p>
        </div>
      </div>
    </section>
  </main>

  <footer style="background:var(--green-1); color:#fff; padding:14px 0; text-align:center; margin-top:34px;">
    © 2025 JKUAT Muslim Students Association | All Rights Reserved
  </footer>

  <!-- ---------- Event Modal (details + media + calendar + form) ---------- -->
  <div class="modal" id="eventModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-content" role="dialog" aria-modal="true">
      <button class="modal-close modal-close-x modal-close-btn" id="closeModal" aria-label="Close">✕</button>
      <div class="modal-body">
        <h3 id="modalTitle">Title</h3>
        <p id="modalDesc">Description</p>

        <div class="modal-media" id="modalMediaArea" aria-hidden="true">
          <!-- image or video injected here -->
        </div>

        <div class="actions" style="margin-top:12px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap">
          <a id="formBtn" class="btn form" target="_blank" rel="noopener">Open Google Form</a>
          <a id="calBtn" class="btn cal" target="_blank" rel="noopener">Add to Google Calendar</a>
          <button id="viewGalleryBtn" class="btn media" type="button">View Gallery</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ---------- Media Modal (for View Gallery) ---------- -->
  <div class="modal" id="mediaModal" aria-hidden="true">
    <div class="modal-dialog modal-content" role="dialog" aria-modal="true">
      <button class="modal-close" id="closeMediaModal" aria-label="Close">✕</button>
      <div style="padding:10px">
        <div id="mediaViewer" style="max-height:70vh; overflow:hidden; border-radius:8px"></div>
      </div>
    </div>
  </div>

  <script>
    /* -------------------------
       Event data (single source)
       - media: array of {type:'img'|'video', src:, poster?}
       - date & end as YYYYMMDD for calendar link
       - form: google form url (sample)
       ------------------------- */
    const events = {
      reg: {
        title: "First Years Registration",
        desc: "Orientation & registration for new students — meet mentors, join prayer groups, and learn about JKUMSA programs.",
        date: "20250901", end: "20250903",
        form: "https://forms.gle/firstyearsform",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&w=1400&q=80"}]
      },
      hafla: {
        title: "First Years Hafla",
        desc: "A welcoming ceremony for first years with nasheeds, short talks, and community bonding.",
        date: "20251004", end: "20251004",
        form: "https://forms.gle/haflaform",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1400&q=80"},
                {type:"video", src:"https://cdn.pixabay.com/vimeo/460716513/conference-59946.mp4"}]
      },
      cooking: {
        title: "Cooking Event",
        desc: "Students prepare meals together to build teamwork and prepare charity packages.",
        date: "20251110", end: "20251110",
        form: "https://forms.gle/cookingevent",
        media: [{type:"video", src:"https://www.w3schools.com/html/mov_bbb.mp4"}]
      },
      conference: {
        title: "Annual Da'wah Conference",
        desc: "Day of talks and training from invited scholars and experienced youth speakers.",
        date: "20260123", end: "20260123",
        form: "https://forms.gle/dawahconference",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1581090700227-1e37b190418e?auto=format&fit=crop&w=1400&q=80"}]
      },
      ramadan: {
        title: "Ramadan (Start)",
        desc: "Start of Ramadan — spiritual preparation activities and reminders.",
        date: "20260220", end: "20260322",
        form: "https://forms.gle/ramadanstart",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1505765059301-2c6d3c1a4b8d?auto=format&fit=crop&w=1400&q=80"}]
      },
      ramadanEnd: {
        title: "Ramadan (End / Eid)",
        desc: "End of Ramadan — arrangements for Eid and community celebrations.",
        date: "20260322", end: "20260322",
        form: "https://forms.gle/ramadanend",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1542736667-069246bdbc6d?auto=format&fit=crop&w=1400&q=80"}]
      },
      iftar: {
        title: "Grand Iftar",
        desc: "Community Iftar — evening meal together in the spirit of Ramadan.",
        date: "20260318", end: "20260318",
        form: "https://forms.gle/grandiftar",
        media: [{type:"video", src:"https://cdn.pixabay.com/vimeo/253693021/teamwork-19360.mp4"}]
      },
      cleaning: {
        title: "Hospital Cleaning",
        desc: "Community service at the local hospital: cleaning, painting, and support.",
        date: "20260615", end: "20260615",
        form: "https://forms.gle/hospitalcleaning",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1532635226-0bd1a8f77b2d?auto=format&fit=crop&w=1400&q=80"}]
      },
      orphanage: {
        title: "Orphanage Visit",
        desc: "Visit to the orphanage: gifts, food, and spending time with the children.",
        date: "20260410", end: "20260410",
        form: "https://forms.gle/orphanagevisit",
        media: [{type:"img", src:"https://images.unsplash.com/photo-1518972559570-1a7a1b5c9eac?auto=format&fit=crop&w=1400&q=80"}]
      },
    };

    /* -------------------------
       Utility: build calendar URL (Google Template)
       Google expects dates like YYYYMMDDTHHMMSSZ or YYYYMMDD
       We'll use T080000Z - T170000Z defaults
       ------------------------- */
    function calendarUrl(title, details, dateStart, dateEnd) {
      const start = `${dateStart}T080000Z`;
      const end   = `${dateEnd}T170000Z`;
      const base = "https://calendar.google.com/calendar/render?action=TEMPLATE";
      const q = `&text=${encodeURIComponent(title)}&details=${encodeURIComponent(details)}&dates=${start}/${end}`;
      return base + q;
    }

    /* -------------------------
       Modal handling
       ------------------------- */
    const modal = document.getElementById('eventModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const formBtn = document.getElementById('formBtn');
    const calBtn = document.getElementById('calBtn');
    const viewGalleryBtn = document.getElementById('viewGalleryBtn');
    const modalMediaArea = document.getElementById('modalMediaArea');
    const closeModalBtn = document.getElementById('closeModal');

    function openEventModal(key){
      const e = events[key];
      if(!e) return;
      modalTitle.textContent = e.title;
      modalDesc.textContent = e.desc;
      formBtn.href = e.form;
      calBtn.href = calendarUrl(e.title, e.desc, e.date, e.end);

      // populate modal media (first item)
      modalMediaArea.innerHTML = '';
      if(e.media && e.media.length){
        const m = e.media[0];
        if(m.type === 'img'){
          const img = document.createElement('img');
          img.src = m.src;
          img.alt = e.title;
          modalMediaArea.appendChild(img);
        } else if(m.type === 'video'){
          const vid = document.createElement('video');
          vid.controls = true;
          vid.preload = 'metadata';
          const src = document.createElement('source');
          src.src = m.src;
          src.type = 'video/mp4';
          vid.appendChild(src);
          modalMediaArea.appendChild(vid);
        }
      }

      // show modal
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');

      // View Gallery opens media modal showing all media for event
      viewGalleryBtn.onclick = () => openMediaModal(e.media || []);
    }

    closeModalBtn.addEventListener('click', closeEventModal);
    modal.addEventListener('click', (ev) => { if(ev.target === modal) closeEventModal(); });

    function closeEventModal(){
      // animate out
      const dialog = modal.querySelector('.modal-dialog');
      dialog.style.animation = 'pop-out .2s forwards';
      setTimeout(()=> {
        dialog.style.animation = ''; modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
      }, 180);
    }

    /* -------------------------
       Media Modal (gallery view for event)
       ------------------------- */
    const mediaModal = document.getElementById('mediaModal');
    const mediaViewer = document.getElementById('mediaViewer');
    const closeMediaModal = document.getElementById('closeMediaModal');
    function openMediaModal(mediaArr){
      mediaViewer.innerHTML = '';
      if(!mediaArr || mediaArr.length===0){
        mediaViewer.innerHTML = '<p style="padding:18px; text-align:center;">No media available.</p>';
      } else {
        mediaArr.forEach(m => {
          if(m.type==='img'){
            const img = document.createElement('img');
            img.src = m.src; img.style.width='100%'; img.style.display='block';
            mediaViewer.appendChild(img);
          } else {
            const v = document.createElement('video');
            v.controls = true; v.preload='metadata'; v.style.width='100%';
            const s = document.createElement('source'); s.src = m.src; s.type='video/mp4';
            v.appendChild(s); mediaViewer.appendChild(v);
          }
        });
      }
      mediaModal.classList.add('show'); mediaModal.setAttribute('aria-hidden','false');
    }
    closeMediaModal.addEventListener('click', ()=> { mediaModal.classList.remove('show'); mediaModal.setAttribute('aria-hidden','true'); });
    mediaModal.addEventListener('click', (ev) => { if(ev.target === mediaModal) { mediaModal.classList.remove('show'); mediaModal.setAttribute('aria-hidden','true'); } });

    /* -------------------------
       Hook clickable table cells
       ------------------------- */
    document.querySelectorAll('td.cell[data-event]').forEach(td => {
      td.addEventListener('click', () => {
        const key = td.dataset.event;
        if (key && key.trim()) openEventModal(key);
      });
    });

    /* ---------- Search / Filter ---------- */
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      const rows = document.querySelectorAll('#eventsTable tbody tr');
      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(q) ? '' : 'none';
      });
    });

    /* -------------------------
       Carousel functionality
       - autoplay, prev/next, dots, pause on hover
       ------------------------- */
    (function(){
      const slidesEl = document.getElementById('slides');
      const slides = Array.from(slidesEl.children);
      const total = slides.length;
      const dotsWrap = document.getElementById('dots');
      let idx = 0, playing=true;
      let timer = null;
      const interval = 5000;

      // build dots
      slides.forEach((s,i)=>{
        const d = document.createElement('button'); d.className='dot'; d.dataset.i = i;
        d.onclick = ()=>{ go(i); resetTimer(); };
        dotsWrap.appendChild(d);
      });

      const dotEls = Array.from(dotsWrap.children);
      function update(){
        slidesEl.style.transform = `translateX(-${idx*100}%)`;
        dotEls.forEach((d,i)=> d.classList.toggle('active', i===idx));
        // autoplay: play video if slide is a video
        slides.forEach((sl,i)=>{
          const v = sl.querySelector('video');
          if(v) { if(i===idx && playing) v.play().catch(()=>{}); else v.pause(); }
        });
      }

      function go(i){
        idx = (i + total) % total; update();
      }
      function next(){ go(idx+1) }
      function prev(){ go(idx-1) }

      document.getElementById('nextBtn').addEventListener('click', ()=>{ next(); resetTimer(); });
      document.getElementById('prevBtn').addEventListener('click', ()=>{ prev(); resetTimer(); });

      function startTimer(){ timer = setInterval(next, interval); }
      function stopTimer(){ clearInterval(timer); timer=null; }
      function resetTimer(){ stopTimer(); startTimer(); }

      // pause on hover
      const carouselEl = document.getElementById('carousel');
      carouselEl.addEventListener('mouseenter', ()=> { playing=false; stopTimer(); slides.forEach(sl=> { const v=sl.querySelector('video'); if(v) v.pause(); })});
      carouselEl.addEventListener('mouseleave', ()=> { playing=true; startTimer(); update(); });

      // init
      update(); startTimer();

      // expose for debugging (not required)
      window.__jk__carousel = {go, next, prev};
    })();

    /* -------------------------
       Accessibility: keyboard close modal with ESC
       ------------------------- */
    window.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        if(document.getElementById('eventModal').classList.contains('show')) closeEventModal();
        if(document.getElementById('mediaModal').classList.contains('show')) { mediaModal.classList.remove('show'); mediaModal.setAttribute('aria-hidden','true'); }
      }
    });

    /* ---------- Done ---------- */
  </script>
</body>
</html>
